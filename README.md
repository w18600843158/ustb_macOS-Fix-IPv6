# Fix IPv6 on macOS

## 用途

北京科技大学校园网环境下，macOS（已证实的版本：10.14、10.13）的IPv6偶尔会掉线。此脚本通过静态设置v6路由的方法暂时解决这一问题。

## 用法

首先你必须登录校园网，并且登录之后v6访问正常。

登录之后，或者等待v6出现问题后，执行下列脚本：

```sh
./fix-v6.sh
```

## 原理

1. 重置当前网络接口的IPv6地址获取方法为自动

2. 等待IPv6地址获取完成后，拿到此时的地址、前缀长度和gloabl的路由地址，静态设置后网络正常

### 实现细节

具体实现与这里有些出入，因为：

- 当IPv6出现问题时，大部分情况下接口的配置已经是自动状态，此时会出现拿不到路由的情况

- 路由地址如果是fe80开头的link-local地址，静态设置后依然会出现掉线问题，所以把路由设置为global地址

所以具体实现的办法是：

1. 重置为自动模式

2. 等待地址，然后静态设置

3. 此时路由是local地址，但是网络是正常的

4. 通过traceroute任意地址的方式拿到global的路由地址

5. 重新设置，结束。

## 其他

在别处连接到校园网时需要重置连接方式为自动。

## LICENSE

MIT

